{% extends "main/base.html" %}

{% block title %}Главная{% endblock %}

{% block content %}
<section id="home">
    <h1 style="color: #fff; text-align: center; text-transform: uppercase; letter-spacing: 2px;">STAY HARD</h1>
    <p style="color: #fff; text-align: center; font-weight: bold; max-width: 800px; margin: 0 auto 30px;">"When you think you're done, you're only 40% done. The other 60% is mental." - David Goggins</p>

    <div style="text-align: center; margin-bottom: 30px;">
        <img src="{{ url_for('static', filename='pictures/12.jpg') }}" alt="Motivation" style="border: 2px solid #fff; max-width: 100%;">
    </div>


    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="auth-tabs">
        <button class="tab-btn active" data-tab="login">LOGIN</button>
        <button class="tab-btn" data-tab="register">REGISTER</button>
    </div>

    <div class="forms-container">
        <form class="auth-form active" id="login-form" method="POST" action="{{ url_for('user.login') }}">
            <input type="text" name="username" placeholder="WARRIOR NAME" required>
            <input type="password" name="password" placeholder="PASSWORD OF DISCIPLINE" required>
            <button type="submit">EMBARK ON THE GRIND</button>
            <p class="auth-link">NOT HARD ENOUGH? <a href="#" class="switch-tab" data-tab="register">ENLIST NOW</a></p>
        </form>


        <form class="auth-form" id="register-form" method="POST" action="{{ url_for('user.register') }}" enctype="multipart/form-data">
            <div class="avatar-section">
                <div class="avatar-preview" id="avatarPreview">
                    <span>⚔️</span>
                </div>
                <input type="file" id="avatar" name="avatar" accept="image/*" class="avatar-input">
                <label for="avatar" class="avatar-btn">CHOOSE YOUR WARRIOR SYMBOL</label>
            </div>
            <input type="text" name="username" placeholder="WARRIOR NAME" required>
            <input type="password" name="password" placeholder="PASSWORD OF DISCIPLINE" required>
            <button type="submit">ENLIST IN THE GRIND</button>
            <p class="auth-link">ALREADY A WARRIOR? <a href="#" class="switch-tab" data-tab="login">LOGIN HERE</a></p>
        </form>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const authForms = document.querySelectorAll('.auth-form');
    const formsContainer = document.querySelector('.forms-container');

    function switchTab(tabName) {
        // Анимация исчезновения
        formsContainer.style.opacity = '0';

        setTimeout(() => {
            // Убрать активный класс со всех кнопок и форм
            tabBtns.forEach(btn => btn.classList.remove('active'));
            authForms.forEach(form => form.classList.remove('active'));

            // Активировать нужную кнопку и форму
            document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-form`).classList.add('active');

            // Анимация появления
            formsContainer.style.opacity = '1';
        }, 300);
    }

    // Обработчики для кнопок табов
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            switchTab(this.dataset.tab);
        });
    });

    // Обработчики для ссылок переключения табов
    document.querySelectorAll('.switch-tab').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            switchTab(this.dataset.tab);
        });
    });

    // JavaScript для предпросмотра аватарки
    const avatarInput = document.getElementById('avatar');
    const avatarPreview = document.getElementById('avatarPreview');

    if (avatarInput && avatarPreview) {
        avatarInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Проверяем размер файла (максимум 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size too large! Please choose an image smaller than 5MB.');
                    return;
                }

                // Проверяем тип файла
                if (!file.type.match('image.*')) {
                    alert('Please select an image file!');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    avatarPreview.innerHTML = '';
                    avatarPreview.style.backgroundImage = `url(${e.target.result})`;
                    avatarPreview.style.backgroundSize = 'cover';
                    avatarPreview.style.backgroundPosition = 'center';
                }
                reader.onerror = function() {
                    alert('Error reading file!');
                }
                reader.readAsDataURL(file);
            }
        });
    }
});
</script>
{% endblock %}